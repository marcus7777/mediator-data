<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<link rel="import" href="../firebase-element/firebase-collection.html">
<!--
`<mediator-data>` 
@demo demo.html
-->

<dom-module id="mediator-data">
  <template>
    https://mediator-data.firebaseio-demo.com

    <firebase-collection location="{{location}}"
                            ref="{{ref}}"
                            data="{{fbCards}}"
                            on-firebase-value="_firebaseLoaded"
                            log=[[log]]></firebase-collection>
    <iron-localstorage name="mediator-data" on-iron-localstorage-load="_backupLoaded" value="{{data}}">
    </iron-localstorage>
  </template>
</dom-module>
<script>
  Polymer({
    is: "mediator-data",
    properties: {
      cards: {
        notify: true
      },
      _firebaseConnected: {
        value: false
      }
    },
    _firebaseLoaded: function() {
      this._firebaseConnected = true;
      this.cards = this.fbCards;
      this.backupCards = this.fbCards;
      this.linkPaths('fbCards', 'cards');
      this.linkPaths('backupCards', 'cards');
    },
    _backupLoaded: function() {
      if (!this._firebaseConnected) {
        this.cards = this.backupCards.slice();
      }
    }
  });
</script>
