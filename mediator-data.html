<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<link rel="import" href="../firebase-element/firebase-collection.html">
<!--
`<mediator-data location="https://mediator-data.firebaseio-demo.com" data="{{}}">` 
@demo demo.html

-->

<dom-module id="mediator-data">
  <template>
    <firebase-collection location="{{fullLocation}}"
      ref="{{ref}}" data="{{fbData}}" on-firebase-value="_firebaseLoaded"
      log=[[_log]]></firebase-collection>
    <iron-localstorage name="[[path]]" on-iron-localstorage-load="_backupLoaded" value="{{backupData}}">
    </iron-localstorage>
  </template>
</dom-module>
<script>
  Polymer({
    is: "mediator-data",
    properties: {
      location:{
        type:String,
        value:"https://mediator-data.firebaseio-demo.com/"
      },
      path: {
        type:String,
        value:""
      },
      data: {
        notify: true
      },
      _fullLocation: {
        computed: "_cat(location,path)"
      },
      _firebaseConnected: {
        value: false
      },
      _log: {
        value: false
      }
    },
    _firebaseLoaded: function() {
      this._firebaseConnected = true;
      this.data = this.fbData;
      this.backupData = this.fbData;
      this.linkPaths('fbData', 'data');
      this.linkPaths('backupData', 'data');
      if (this._log) {
        console.log(data, this.data)
      }
    },
    _backupLoaded: function() {
      if (!this._firebaseConnected) {
        this.data = this.backupData.slice();
      }
    },
    _cat: function(location,path) {
      return location+path;
    }
  });
</script>
