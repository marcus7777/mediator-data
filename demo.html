<!doctype html>
<html>
  <head>
    <title>mediator-data demo</title>
    <script src="../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="mediator-data.html">
  </head>
  <body>
    <h3>mediator-data Demo</h3>
    <template is="dom-bind">
      <h1>todo</h1>
      <mediator-data data="{{a}}" location="https://mediator-data.firebaseio-demo.com/" folder="todo" type="firebase"></mediator-data>
      <card-view cards="{{a}}"></card-view>
      <h1>Badge</h1>
      <mediator-data data="{{b}}" location="https://mediator-data.firebaseio-demo.com/" folder="badges" type="firebase"></mediator-data>
      <badge-view badges="{{b}}"></badge-view>
    </template>
  </body>
</html>

<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../icon-icons/maps-icons.html">
<link rel="import" href="../icon-icons/iron-icons.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../firebase-element/firebase-collection.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html">
<!-- 
88                                88                                      
88                                88                                      
88                                88                                      
88,dPPYba,   ,adPPYYba,   ,adPPYb,88   ,adPPYb,d8   ,adPPYba,  ,adPPYba,  
88P'    "8a  ""     `Y8  a8"    `Y88  a8"    `Y88  a8P_____88  I8[    ""  
88       d8  ,adPPPPP88  8b       88  8b       88  8PP"""""""   `"Y8ba,   
88b,   ,a8"  88,    ,88  "8a,   ,d88  "8a,   ,d88  "8b,   ,aa  aa    ]8I  
8Y"Ybbd8"'   `"8bbdP"Y8   `"8bbdP"Y8   `"YbbdP"Y8   `"Ybbd8"'  `"YbbdP"'  
                                       aa,    ,88                         
                                        "Y8bbdP"                         
           -->
<dom-module id="badge-view">
  <template>
    <div class="content">
      <badge-list badges="{{badges}}"
        on-delete-badge="deleteBadge">
      </badge-list>
      <badge-input on-add-badge="addBadge"></badge-input>
    </div>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'badge-view',
    properties: {
      badges: Array
    },
    addBadge: function(e) {
      this.push('badges', {
        icon: e.detail.icon,
        subtitle: e.detail.subtitle,
        title: e.detail.title,
        isComplete: false
      });
    },
    deleteBadge: function(e) {
      this.arrayDelete('badges', e.detail.badge);
    }
  });
</script>

<dom-module id="badge-list">
  <template>
    <p class="no-more-msg" hidden="[[_empty(badges.length)]]">No badges</p>
    <template is="dom-repeat" items="{{badges}}" observe="isComplete">
      <badge-item badge="{{item}}"></badge-item>
    </template>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'badge-list',
    properties: {
      badges: Array,
      filterBy: {
        type: String,
        value: 'all'
      }
    },
    _empty: function(length) {
      return !!length;
    }
  });
</script>
<dom-module id="badge-item">
  <template>
    <paper-material class="row layout horizontal center">
      <h1>{{badge.title}}</h1>
      <h2>{{badge.subtitle}}</h2>
      <iron-icon icon="{{badge.icon}}"></iron-icon>
      <paper-checkbox id="checkbox" checked="{{badge.isComplete}}">
      </paper-checkbox>
      <paper-icon-button icon="delete"
        class="btn-cancel"
        aria-label="Delete Badge"
        tabindex="0"
        on-tap="_onDelete">
      </paper-icon-button>
    </paper-material>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'badge-item',
    _onDelete: function() {
      this.fire('delete-badge', {badge: this.badge});
    }
  });
</script>
<dom-module id="badge-input">
  <template>
    <div class="input-wrapper">
      <paper-input id="badgeTitle"
                   label="Title">
      </paper-input>
      <paper-input id="badgeSubtitle"
                   label="Subtitle">
      </paper-input>
      <paper-input label="Icon" value="{{icon}}"
                   on-keydown="_checkAdd">
      </paper-input>
      <template is="dom-repeat" items="{{iconLists}}">
        <template is="dom-repeat" items="{{item}}">
          <iron-icon on-tap="_setIcon" icon="{{item}}"></iron-icon>
        </template>
        <br/>
      </template>
      <a href="http://open-elements.org/bower_components/iron-icons/demo/index.html">more icons</a>
      <paper-button on-tap="_add">Add</paper-button>
    </div>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'badge-input',
    properties: {
      iconLists:{type: Array, value: 
        [
          ["android","book","shopping-cart","build","check"],
          ["face","favorite","grade","note-add","language"],
          ["help","gesture","bug-report","attachment","assignment-return"],
          ["accessibility","account-balance","drafts","account-circle","backspace"],
          ["autorenew","block","card-travel","change-history","content-paste"]
        ] 
      }
    },
    // Listen for ENTER key
    _checkAdd: function(e) {
      if (e.keyCode === 13) {
        this._add();
      }
    },
    _add: function() {
      if (this.$.badgeTitle.value && this.$.badgeSubtitle.value && this.icon) {
        this.fire('add-badge', {
          title: this.$.badgeTitle.value,
          subtitle: this.$.badgeSubtitle.value,
          icon: this.icon
        });
        this.$.badgeTitle.value = null;
        this.$.badgeSubtitle.value = null;
        this.icon = null;
      }
    },
    _setIcon: function(e){
      this.icon = e.target.icon;
    } 
  });
</script>

<!--
.------..------..------..------..------.
|C.--. ||A.--. ||R.--. ||D.--. ||S.--. |
| :/\: || (\/) || :(): || :/\: || :/\: |
| :\/: || :\/: || ()() || (__) || :\/: |
| '--'C|| '--'A|| '--'R|| '--'D|| '--'S|
`------'`------'`------'`------'`------'
-->


<dom-module id="card-view">
  <template>
    <div class="content">
      <card-list cards="{{cards}}"
        on-delete-card="deleteCard">
      </card-list>
      <card-input on-add-card="addCard"></card-input>
    </div>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'card-view',
    properties: {
      cards: Array
    },
    addCard: function(e) {
      this.push('cards', {
        label: e.detail.value,
        isComplete: false
      });
    },
    deleteCard: function(e) {
      this.arrayDelete('cards', e.detail.card);
    }
  });
</script>

<dom-module id="card-item">
  <template>
    <paper-material class="row layout horizontal center">
      <paper-checkbox id="checkbox"
        checked="{{card.isComplete}}"
        aria-labelledby$="[[_computeLabelId(card.uid)]]">
      </paper-checkbox>
      <paper-input id="[[_computeLabelId(card.uid)]]"
        class="flex"
        value="{{card.label}}"
        no-label-float
        on-keypress="_checkConfirmation">
      </paper-input>
      <paper-icon-button icon="delete"
        class="btn-cancel"
        aria-label="Delete Card"
        tabindex="0"
        on-tap="_onDelete">
      </paper-icon-button>
    </paper-material>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'card-item',
    properties: {
      favorite: {
        type: Boolean, value: false, notify: true
      }
    },
    _computeLabelId: function(uid) {
      return 'cardItemLabel-' + uid;
    },
    _onDelete: function() {
      this.fire('delete-card', {card: this.card});
    }
  });
</script>
<dom-module id="card-input">
  <template>
    <div class="input-wrapper">
      <paper-input id="cardInput"
                   no-label-float
                   label="Add a Card"
                   on-keydown="_checkAdd">
      </paper-input>
      <paper-button on-tap="_add">Add</paper-button>
    </div>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'card-input',
    // Listen for ENTER key
    _checkAdd: function(e) {
      if (e.keyCode === 13) {
        this._add();
      }
    },
    _add: function() {
      if (this.$.cardInput.value) {
        this.fire('add-card', {value: this.$.cardInput.value});
        this.$.cardInput.value = null;
      }
    }
  });
</script>
<dom-module id="card-list">
  <template>
    <p class="no-more-msg" hidden="[[_cardsEmpty(cards.length)]]">No more cards! Add Some</p>
    <template is="dom-repeat"
              items="{{cards}}"
              as="card"
              filter="{{_computeFilter(filterBy)}}"
              observe="isComplete">
      <card-item card="{{card}}"></card-item>
    </template>
  </template>
</dom-module>
  <script>
    Polymer({
      is: 'card-list',
      properties: {
        cards: Array,
        filterBy: {
          type: String,
          value: 'all'
        }
      },
      _cardsEmpty: function(length) {
        return !!length;
      },
      _computeFilter: function(filterBy) {
        if (filterBy) {
          // If filterBy is 'all', return a filter that always returns
          // the card
          if (filterBy === 'all') {
            return function(item) {
              return item;
            };
          }
          // Handle 'notfavorite', or its inverse, 'favorite'
          var ifComplete = (filterBy === 'notfavorite');
          return function(item) {
            return item.isComplete === ifComplete;
          };
        }
      }
    });
  </script>
